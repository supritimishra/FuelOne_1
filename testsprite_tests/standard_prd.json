{
  "meta": {
    "project": "Ramkrishna Service Centre Petrol Pump Management System",
    "date": "2025-10-29",
    "prepared_by": "Generated by PetroPal System"
  },
  "product_overview": "The Ramkrishna Service Centre Petrol Pump Management System is a comprehensive, web-based platform designed to streamline and manage the end-to-end operations of a petrol pump. Featuring modules for master data management, diverse sales and purchase operations, financial tracking, inventory monitoring, employee and vendor management, and reporting, the system provides a secure, efficient, and scalable solution built with modern technologies.",
  "core_goals": [
    "Provide a unified platform to manage all petrol pump operations including sales, purchases, and inventory.",
    "Ensure secure user authentication and role-based access control for data security and management.",
    "Enable real-time data tracking with a dynamic dashboard showing key metrics and recent transactions.",
    "Support comprehensive financial management including recoveries, expenses, settlements, and dues management.",
    "Maintain accurate and up-to-date inventory records for fuel products, lubricants, tanks, and nozzles.",
    "Facilitate detailed reporting and analytics for better business decision-making.",
    "Provide extensible and maintainable architecture using modern web technologies and best practices."
  ],
  "key_features": [
    "JWT-based authentication system with httpOnly cookies, secure password hashing, and role-based access control.",
    "Master data management modules for fuel products, lubricants, employees, vendors, tanks, nozzles, and expense types.",
    "Comprehensive sales operations covering guest sales, credit sales with customer tracking, swipe sales, tanker sales, and lubricant sales.",
    "Purchase management modules for liquid fuel and lubricant purchases with vendor integration.",
    "Daily operational modules including daily cash reports, denomination tracking, daily sale rate management, recoveries, day settlements, and meter reading entries.",
    "Robust financial management including recoveries, expenses tracking, business and vendor transactions, and interest calculations.",
    "Advanced reporting and statement generation modules including credit limit reports, stock reports, lubricant loss, and minimum stock alerts.",
    "Dashboard aggregating real-time sales, purchases, credit status, and recent transactions.",
    "API and frontend implemented using TypeScript, React 18, Express.js, PostgreSQL with Drizzle ORM, and styled with Tailwind CSS using Shadcn/ui components.",
    "State management and data fetching powered by TanStack Query v5 with cache invalidation and optimistic updates.",
    "Form handling and validation using React Hook Form combined with Zod schemas for robust input validation."
  ],
  "user_flow_summary": [
    "Users start by authenticating with email/username and password to gain access to protected routes via JWT tokens stored in httpOnly cookies.",
    "Upon login, users access the dashboard providing an overview of sales, purchases, credit status, and recent transactions.",
    "Users navigate through master data modules to manage products, customers, employees, vendors, tanks, and nozzles creating, updating, or deleting records as needed.",
    "For sales, users choose from guest, credit, swipe, tanker, or lubricant sales modules, enter transaction details verified by frontend and backend validations, and submit the data which updates inventory and financial records.",
    "Purchase workflows allow entering liquid or lubricant purchase details linked to vendors and update stock levels accordingly.",
    "Daily operations such as sale entries, duty pays, credit requests, and recoveries follow guided forms where data is validated and processed, causing updates in relevant reports and dashboards.",
    "Users generate and view reports including statements, stock levels, and credit limit reports with filtering by date ranges and parties.",
    "System administrators manage configurations, user logs, and system settings ensuring smooth and secure operations.",
    "Throughout, the system employs cache invalidation post mutations to keep the UI in sync with backend changes for a responsive user experience."
  ],
  "validation_criteria": [
    "Successful user authentication and authorization enforcing role-based access control.",
    "RESTful API endpoints responding with standardized success and error formats.",
    "All CRUD operations for master data and transactional modules correctly updating the database without errors.",
    "Frontend forms validate inputs against Zod schemas and reflect errors before submission.",
    "Real-time dashboard accurately reflects current sales, purchases, credit status, and financial data.",
    "Database triggers correctly auto-calculate quantities, totals, and update stock and balances upon relevant transactions.",
    "Cache invalidation in TanStack Query triggers expected queries to refetch and update the UI accordingly.",
    "Security requirements like password hashing, JWT token management, and httpOnly cookie usage are correctly implemented.",
    "Date handling and formatting comply with specified formats (YYYY-MM-DD) especially for month inputs converted to first-of-month date.",
    "API endpoints reject invalid UUIDs, malformed requests, and unauthorized access with appropriate error codes and messages.",
    "System passes comprehensive integration tests covering all main API endpoints and data flows.",
    "Data integrity is maintained across tables with proper relationships and foreign key constraints enforced."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "JavaScript",
      "React 18",
      "Express.js",
      "PostgreSQL",
      "Drizzle ORM",
      "Vite",
      "Shadcn/ui",
      "Tailwind CSS",
      "TanStack Query",
      "React Hook Form",
      "Zod",
      "JWT"
    ],
    "features": [
      {
        "name": "Authentication",
        "description": "JWT-based authentication system with httpOnly cookies, password hashing, role-based access control",
        "files": [
          "src/pages/Auth.tsx",
          "src/pages/ResetPassword.tsx",
          "src/pages/ChangePassword.tsx",
          "server/auth.ts",
          "server/auth-routes.ts",
          "src/hooks/useAuth.tsx",
          "src/components/ProtectedRoute.tsx"
        ]
      },
      {
        "name": "Dashboard",
        "description": "Main dashboard displaying overview metrics and navigation",
        "files": [
          "src/pages/Dashboard.tsx",
          "src/pages/Index.tsx"
        ]
      },
      {
        "name": "Guest Sales",
        "description": "Sales management for guest customers with multiple payment modes",
        "files": [
          "src/pages/GuestSale.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Credit Sales",
        "description": "Credit sales management with customer tracking and limits",
        "files": [
          "src/pages/CreditSale.tsx",
          "src/pages/CreditSaleUI.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Recovery",
        "description": "Customer recovery/payment collection management",
        "files": [
          "src/pages/Recovery.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Settlement",
        "description": "Daily settlement and cash reconciliation",
        "files": [
          "src/pages/Settlement.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Interest Transactions",
        "description": "Interest transaction management for loans and payments",
        "files": [
          "src/pages/InterestTransactions.tsx",
          "src/pages/InterestTransactionsEnhanced.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Employee Cash Recovery",
        "description": "Employee cash recovery and balance tracking",
        "files": [
          "src/pages/EmployeeCashRecovery.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Sheet Records",
        "description": "Sheet record management for transactions",
        "files": [
          "src/pages/SheetRecords.tsx",
          "src/pages/SheetRecordsEnhanced.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Expenses",
        "description": "Expense tracking and management",
        "files": [
          "src/pages/Expenses.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Fuel Products",
        "description": "Fuel product master data management",
        "files": [
          "src/pages/admin/FuelProducts.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Employees",
        "description": "Employee management and administration",
        "files": [
          "src/pages/admin/Employees.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Credit Customers",
        "description": "Credit customer management with limits and balances",
        "files": [
          "src/pages/CreditCustomers.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Tanks and Nozzles",
        "description": "Fuel tank and nozzle configuration management",
        "files": [
          "src/pages/admin/TanksNozzles.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Stock Reports",
        "description": "Stock reporting and inventory tracking",
        "files": [
          "src/pages/StockReport.tsx",
          "src/pages/OpeningStock.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Sales Reports",
        "description": "Sales reporting and analytics",
        "files": [
          "src/pages/SalesReport.tsx",
          "src/pages/DailyReport.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Lubricant Sales",
        "description": "Lubricant sales management",
        "files": [
          "src/pages/LubricantSale.tsx",
          "src/pages/LubSale.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Tanker Sales",
        "description": "Tanker sales management",
        "files": [
          "src/pages/TankerSale.tsx",
          "src/pages/TankerSaleEnhanced.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Swipe Sales",
        "description": "Card swipe transaction management",
        "files": [
          "src/pages/SwipeSale.tsx",
          "src/pages/SwipeUI.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "Vendor Management",
        "description": "Vendor and supplier management",
        "files": [
          "src/pages/admin/Vendors.tsx",
          "server/routes.ts"
        ]
      },
      {
        "name": "UI Components",
        "description": "Reusable UI components using Shadcn/ui and Radix UI",
        "files": [
          "src/components/ui/button.tsx",
          "src/components/ui/input.tsx",
          "src/components/ui/card.tsx",
          "src/components/ui/table.tsx",
          "src/components/ui/select.tsx",
          "src/components/ui/dialog.tsx",
          "src/components/ui/toast.tsx"
        ]
      },
      {
        "name": "Database Schema",
        "description": "Type-safe database schema definitions using Drizzle ORM",
        "files": [
          "shared/schema.ts"
        ]
      },
      {
        "name": "API Routes",
        "description": "RESTful API endpoints for all application features",
        "files": [
          "server/routes.ts",
          "server/index.ts"
        ]
      },
      {
        "name": "Tenant Management",
        "description": "Multi-tenant database connection and management",
        "files": [
          "server/middleware/tenant.ts",
          "server/services/tenant-provisioning.ts",
          "server/services/db-connection-manager.ts"
        ]
      }
    ]
  }
}
